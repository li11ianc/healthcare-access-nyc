---
title: "Project Draft"
author: '%>% it Up!: Lilly Clark, Thea Dowrich and Daisy Fang'
date: "4/15/2020"
output: 
  html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```

```{r packages}
library(tidyverse)
library(gifski)
library(gganimate)
library(ggmap)
library(maps)
library(usmap)
library(viridis)
library(patchwork)
```

```{r load-data}
## facilities <- read.csv("data/raw/facility.csv")
insurance <- read.csv("data/insurance.csv")
inpatients <- read.csv("data/medicare_inpatients.csv")
medicaid <- read_csv("data/Total Medicaid.csv")
states_pop <- read.csv("data/states_pop.csv")
```

## Introduction
***
The beginning of this new decade has been marked by significant uncertainty and difficulty. Coronavirus disease (COVID-19) originated in Wuhan, China in December 2019, but was not declared a Public Health Emergency of International Concern by the World Health Organization (WHO) until January 30. On March 11, WHO recognized the coronavirus as a pandemic  and on March 13, the United States declared a national emergency. 

After Donald Trump declared a national emergency, life as we knew it in America was largely disrupted: schools, colleges and universities closed, restaurants and bars prohibit dining in, and companies have shifted to remote work.  Stay-at-home and shelter-in-place orders have been in place across the nation, but individual responses per state have been largely variable. Responses by state are primarily dependent upon their healthcare system’s capacity. Testing has not been universally accessible and the number of necessary equipment (i.e., ventilators) is not up to standard, across the board.  

Coronavirus has been shown to impact marginalized communities at a more intense rate, but nobody is immune to the virus. Nationwide, access to specialized medical care is highly dependent upon one’s socioeconomic and employment status. Thus, we wanted to take a deeper look into these access disparities in the age of a global pandemic. Changes to healthcare policy, such as the Affordable Care Act of 2010 (ACA), have made inexpensive healthcare available to more constituents.  However, there is still a long way to go, and the virus has brought many of these inequalities to light.

The following questions guided our research in investigating nationwide healthcare inequity: 

<br>
1.	Are there disparities in healthcare access across the United States?

<br>
2.	As New York was one of the first hot spots for the virus, what inequalities to access exist within the state?

<br>
3.	How do these differences in access relate to differences in patient experience?

<br>
4.	How have health policy changes influenced accessibility? 


## Changes in Healthcare Policy and Access
***
### Background

The United States Department of Health and Human Services (HHS) was established in 1953 with the goal to “enhance and protect the health and well-being of all Americans.”  The HHS works alongside lawmakers to pass legislation to support this goal and improve patient outcomes. Over the course of its history it has supported eight pieces of legislation that have impacted the lives of the American people.

The Social Security Amendments of 1965 created Medicaid, a program that assists with medical costs for low-income individuals. As of 2017, Medicaid was the largest source for medical and health-related services, providing free insurance to 74 million low-income and disabled persons. This makes up 23% of all Americans. Although Medicaid is federally and state funded, it is up to each state’s discretion to determine who is eligible and the on-the-ground implementation of the program.

Medicare is a national health insurance program that began in 1966 under the Johnson administration. Medicare primarily provides health insurance to persons above the age of 65, as well as younger constituents with a disability status as determined by the Social Security Administration. Although Medicare does not cover all of the expenses associated with healthcare, it has been shown to cover approximately half of the expenses for those enrolled in the program. 

The Health Care Quality Improvement Act (HCQIA) was enacted in 1986 as a response to the relative relaxation on physician peer review participation because of the threat of litigation. Congress found it necessary to enact this law to: <br>
•	Reduce the occurrence of medical malpractice <br>
•	Prevent incompetent physicians from moving from state to state without full disclosure <br>
•	Incentivize physicians to engage in professional peer review. <br>

The Health Insurance Portability and Accountability Act of 1996 (HIPAA) is a federal law that mandated the creation of national standards to protect sensitive patient health information from being disclosed without their consent. Moreover, HIPAA prevents insurers from discriminating against applicates based on health conditions or prior histories.

In 1997, the Children’s Health Insurance Program (CHIP) was established to deliver health coverage to low-income children. CHIP was implemented to expand coverage to children whose incomes are low, yet not low enough to qualify for Medicaid. Similar to Medicaid, CHIP is a federal-state partnership, but allocation and administration is determined by individual states.

In 2005, the Patient Safety and Quality Improvement Act (PSQIA) established a voluntary reporting system in an effort to improve the assessible data and resolve patient safety and healthcare quality issues. Similar to HCQIA, PSQIA encourages the reporting and analysis of medical errors by providing federal confidentiality protections for patient safety information. 

The Affordable Care Act (ACA) was sanctioned by President Obama in March 2010. ACA increased the number of insured Americans by providing consumers with premium tax credits that lower the costs for households living between 100% and 400% of the federal poverty level. Additionally, it expanded Medicaid to cover all adults with income below 138% of the federal poverty level, although not all states have expanded their programs. ACA requires most citizens to apply for health insurance coverage, but also established that firms with more than 200 employees must provide health insurance.

Finally, The Affordable Care Act established the Hospital Readmissions Reduction Program (HRRP) in 2012. HRRP is a Medicare value-based purchasing program that lowers payments to hospitals with excess readmissions. The goal of this program is to improve patient outcomes and link funding to the quality of hospital care, the idea being that high quality care will reduce the necessity for readmission. 

These landmark healthcare reform laws have improved patient experience and expanded access to many citizens who were previously excluded from coverage. However, the federal-state partnerships give many states leeway in terms of how they determine who is eligible for these government assistance programs. Although many more people have insurance than before, it can still be seen that there is a long way to go before access is not only affordable, but also equitable. 

```{r us-hospitals}
## Disparities in Healthcare Access

facilities <- left_join(facilities, states_pop, by = c("state" = "states_abb"))

# filter for hospitals in the contiguous US
hospitals <- facilities %>% 
  filter(overall_type == "hospital") %>% 
  #filter(long > -130 & long < -60) %>% 
  #filter(lat > 20 & lat < 50) %>% 
  mutate(owner = as.character(owner)) %>% 
  mutate(general_owner = case_when(owner %in% c("Government - District/Authority", "Government - Federal",
                                             "Government - Local", "Government - State") ~ "Government",
                                   owner == "Proprietary" ~ "For-Profit",
                                   TRUE ~ owner))

# map of hospitals
hospital_cnt <- hospitals %>% 
  group_by(state) %>% 
  summarize(total_hospitals = n(),
            total_beds = sum(beds, na.rm = TRUE))

hospital_cnt <- left_join(hospital_cnt, states_pop, by = c("state" = "states_abb"))

hospital_cnt <- hospital_cnt %>% 
  mutate(hospital_ratio = states_pop / total_hospitals,
         hospital_percap = total_hospitals / states_pop,
         bed_percap = total_beds / states_pop)

plot_usmap(data = hospital_cnt, values = 'total_hospitals') + 
  scale_fill_continuous(low = "white", high = "brown",
                        name = "# Hospitals", label = scales::comma) + theme(legend.position = "right")

plot_usmap(data = hospital_cnt, values = 'hospital_ratio') + 
  scale_fill_continuous(low = "white", high = "brown",
                        name = "Avg. # people served \nper hospital", label = scales::comma) + theme(legend.position = "right")

plot_usmap(data = hospital_cnt, values = 'hospital_percap') + 
  scale_fill_continuous(low = "white", high = "brown",
                        name = "# Hospital Per Capita", label = scales::comma) + theme(legend.position = "right")

plot_usmap(data = hospital_cnt, values = 'bed_percap') + 
  scale_fill_continuous(low = "white", high = "brown",
                        name = "# Beds Per Capita", label = scales::comma) + theme(legend.position = "right")
```

```{r hospital-owner}
# proportion of owner type by state bar graph
hospitals %>% 
  filter(general_owner != "Not Available") %>% 
  filter(state %in% c("NY", "CA", "TX", "NC")) %>% 
  ggplot(aes(x = state, fill = general_owner)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Set2") +
  theme_light() +
  labs(x = "State", y = "Proportion", fill = "Owner type",
       title = "Proportion of Hospital Owner Types Differ Largely by State")
```

## Changes in Healthcare Policy and Access

***
The previously mentioned policy changes are marked by the consistent goal to improve the health and well-being for all Americans. A particularly vulnerable population within the healthcare arena is low-income individuals, as shown in how many of these policies directly target this demographic. Therefore, it is important to look at how changes in Medicaid policy, as well as other healthcare reform legislation, have influenced coverage on the state-level. The following visualization depicts the relationship between Medicaid spending and enrollee population from 1991 to 2014. 

```{r medicaid-changes, cache=TRUE}
medicaid <- medicaid %>%
  rename(
    spending = `Spending (in Millions of Dollars)`,
    enrollment = `Medicaid Enrollee Population (Thousands)`
  )

medicaid$Year <- as.integer(medicaid$Year)

ggplot(data = medicaid, mapping = aes(x = spending, y = enrollment, colour = State)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  scale_y_log10() +
  facet_wrap(~Region, ncol = 4) +
  theme_light(base_size = 11) +
  labs(title = "Changes in Medicaid Spending and Enrollment",
    subtitle = 'Year: {frame_time}', x = 'Medicaid Spending', y = 'Medicaid Enrollee Population') +
  transition_time(Year) +
  ease_aes('linear')
```

***

```{r nyc-changes, fig.align = "center"}
total <- read_csv("data/TM with USA.csv")

ny <- medicaid %>%
  filter(State == "New York")

usa <- total %>%
  filter(State == "United States")

spending <- ggplot() +
  geom_line(data = ny, mapping = aes(x = Year, y = spending), color = "blue") +
  labs(title = "Changes in Medicaid Spending",
       subtitle = "for the state of New York from 1991 to 2014",
       x = "Year", y = "Spending (in Millions of Dollars)") +
  theme_light()

enrollment <- ggplot() +
  geom_line(data = ny, mapping = aes(x = Year, y = enrollment), color = "blue") +
  labs(title = "Changes in Medicaid Enrollee Population",
       subtitle = "for the state of New York from 1991 to 2014",
       x = "Year", y = "Enrollment (in Thousands)") +
  theme_light()

spending / enrollment
```

